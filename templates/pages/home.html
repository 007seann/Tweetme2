{% extends 'base.html' %} {% block head_title %} Beta {% endblock head_title %}
{% block content %} Welcome to Tweetme 2 :)

<div id="tweets">Loading...</div>

<script>
  const tweetsElement = document.getElementById('tweets'); // get an html element
  {% comment %} tweetsElement.innerHTML = 'Loading...'; // set new html in that element

  var el1 = '<h1> Hi there 1 </h1>';
  var el2 = '<h1> Hi there 2 </h1>';
  var el3 = '<h1> Hi there 3 </h1>';
  tweetsElement.innerHTML = el1 + ' ' + el2 + ' ' + el3; {% endcomment %}

  const xhr = new XMLHttpRequest(); // xhr = SomeClass()
  const method = 'GET'; // 'POST'
  const url = '/tweets';
  const responseType = 'json';

  function handleDidLike (tweet_id, currentCount) {
    console.log(tweet_id, currentCount)
    return 
  }

  function LikeBtn(tweet) {
    return "<button class='btn btn-primary btn-sm' onclick=handleDidLike(" + tweet.id + "," + tweet.likes + ")>" + tweet.likes + " Like</button>"
  }

  function formattedTweetObject(tweet) {
    var formattedTweet = "<div class='mb-4 tweet' id='tweet-" + tweet.id + " '><p>" + tweet.content + "</p><div class='btn-group'>"+ LikeBtn(tweet) + "</div></div>"
    return formattedTweet;
  }

  xhr.responseType = responseType;
  xhr.open(method, url);
  xhr.onload = function () {
    const serverResponse = xhr.response; //
    const listedItems = serverResponse.response; // array
    var finalTweetStr = ''
    for (var i = 0; i < listedItems.length; i++) { // 배운걸로 수정
      var tweetObject = listedItems[i]
      var currentItem = formattedTweetObject(tweetObject)
        finalTweetStr += currentItem

    }
    tweetsElement.innerHTML = finalTweetStr
    {% comment %} console.log(listedItems); {% endcomment %}
  };
  xhr.send();
</script>

{% endblock content %}
